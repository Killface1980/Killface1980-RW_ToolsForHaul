<?xml version="1.0" encoding="utf-8" ?>
<ThingDefs>

  <ThingDef Name="BaseBullet" Abstract="True">
    <category>Projectile</category>
    <tickerType>Normal</tickerType>
    <altitudeLayer>Projectile</altitudeLayer>
    <thingClass>Bullet</thingClass>
    <label>bullet</label>
    <useHitPoints>False</useHitPoints>
    <neverMultiSelect>True</neverMultiSelect>
    <graphicData>
      <shaderType>Transparent</shaderType>
    </graphicData>
  </ThingDef>

  <ThingDef Name="BaseGun" Abstract="True">
    <category>Item</category>
    <thingClass>ThingWithComps</thingClass>
    <equipmentType>Primary</equipmentType>
    <pathCost>10</pathCost>
    <useHitPoints>True</useHitPoints>
    <selectable>True</selectable>
    <graphicData>
      <onGroundRandomRotateAngle>35</onGroundRandomRotateAngle>
    </graphicData>
    <drawGUIOverlay>true</drawGUIOverlay>
    <statBases>
      <MaxHitPoints>100</MaxHitPoints>
      <Flammability>1.0</Flammability>
      <DeteriorationRate>2</DeteriorationRate>
      <SellPriceFactor>0.5</SellPriceFactor>
    </statBases>
    <altitudeLayer>Item</altitudeLayer>
    <alwaysHaulable>True</alwaysHaulable>
    <tickerType>Never</tickerType>
    <techLevel>Industrial</techLevel>
    <thingCategories>
      <li>WeaponsRanged</li>
    </thingCategories>
    <comps>
      <li Class="CompProperties_Forbiddable"/>
      <li>
        <compClass>CompEquippable</compClass>
      </li>
      <li>
        <compClass>CompQuality</compClass>
      </li>
      <li Class="CompProperties_Art">
        <nameMaker>ArtName_WeaponGun</nameMaker>
        <descriptionMaker>ArtDescription_WeaponGun</descriptionMaker>
        <minQualityForArtistic>Excellent</minQualityForArtistic>
      </li>
    </comps>
  </ThingDef>


  <ThingDef Name="BaseHumanGun" ParentName="BaseGun" Abstract="True">
    <weaponTags>
      <li>Gun</li>
    </weaponTags>
  </ThingDef>

  <!--=============== Improvised turret ===============-->

  <ThingDef ParentName="VehicleBase">
    <defName>VehicleCombatATV</defName>
    <label>CombatATV</label>
    <thingClass>ToolsForHaul.Vehicle_TurretGun</thingClass>
    <graphicData>
      <texPath>Things/Pawn/VehicleCombatATV/CombatATV</texPath>
      <graphicClass>Graphic_Multi</graphicClass>
      <drawSize>(3,3)</drawSize>
      <damageData>
        <!-- no damage marks because they don't move with the vehicle <rect>(0,0.12,1,0.76)</rect>-->
        <enabled>false</enabled>
      </damageData>
    </graphicData>
    <repairEffect>Repair</repairEffect>
    <statBases>
      <MaxHitPoints>250</MaxHitPoints>
      <Flammability>1.0</Flammability>
      <Beauty>10</Beauty>
      <VehicleSpeed>12</VehicleSpeed>
    </statBases>
    <comps>
      <li Class="CompProperties_Explosive">
        <explosiveRadius>2.4</explosiveRadius>
        <explosiveDamageType>Flame</explosiveDamageType>
        <explosiveExpandPerStackcount>0.4</explosiveExpandPerStackcount>
        <startWickHitPointsPercent>0.1</startWickHitPointsPercent>
        <chanceNeverExplodeFromDamage>0.5</chanceNeverExplodeFromDamage>
        <wickTicks>
          <min>300</min>
          <max>600</max>
        </wickTicks>
        <postExplosionSpawnThingDef>Puddle_BioDiesel_Fuel</postExplosionSpawnThingDef>
        <postExplosionSpawnChance>1</postExplosionSpawnChance>
        <postExplosionSpawnThingCount>3</postExplosionSpawnThingCount>
        <applyDamageToExplosionCellsNeighbors>true</applyDamageToExplosionCellsNeighbors>
        <explosionEffect>VehicleExplosion</explosionEffect>
      </li>
      <li Class="CompProperties_Refuelable">
        <!-- Fuel consumption only called once every 96 ticks -->
        <fuelConsumptionRate>3000</fuelConsumptionRate>
        <fuelCapacity>100.0</fuelCapacity>
        <fuelFilter>
          <thingDefs>
            <li>Biodiesel</li>
          </thingDefs>
        </fuelFilter>
        <consumeFuelOnlyWhenUsed>true</consumeFuelOnlyWhenUsed>
      </li>
      <li Class="ToolsForHaul.Components.CompProperties_Axle">
        <axles>
          <li>(-25,-45)</li>
          <li>(55,-45)</li>
        </axles>
      </li>
      <li Class="ToolsForHaul.Components.CompProperties_Vehicle">
        <showsStorage>false</showsStorage>
        <animalsCanDrive>false</animalsCanDrive>
        <fuelCatchesFireHitPointsPercent>0.2</fuelCatchesFireHitPointsPercent>
        <motorizedWithoutFuel>false</motorizedWithoutFuel>
        <soundAmbient>VehicleCombattATV_Ambience</soundAmbient>
        <specialshadowData>
          <volume>(0.65, 0.6, 0.5)</volume>
          <offset>(0,0,-0.3)</offset>
        </specialshadowData>
      </li>
      <li Class="CompProperties_Breakdownable"/>
    </comps>
    <pathCost>50</pathCost>
    <description>An improvised vehicle turret that automatically fires at nearby enemies. Explodes when damaged. Its hacked-together AI brain isn't very smart, and can't be directly controlled, so beware of friendly fire.</description>
    <isAutoAttackableWorldObject>true</isAutoAttackableWorldObject>
    <thingCategories>
      <li>Vehicles</li>
    </thingCategories>
    <size>(1,1)</size>
    <inspectorTabs>
      <li>ToolsForHaul.ITabs.ITab_Pawn_VehicleGear</li>
    </inspectorTabs>
    <CostList>
      <Steel>150</Steel>
      <Plasteel>10</Plasteel>
      <Component>10</Component>
      <VehicleATVFrame>1</VehicleATVFrame>
    </CostList>
    <leaveResourcesWhenKilled>false</leaveResourcesWhenKilled>
    <killedLeavings>
      <VehicleATVFrame>1</VehicleATVFrame>
    </killedLeavings>
    <recipeMaker>
      <workSpeedStat>SmithingSpeed</workSpeedStat>
      <workSkill>Crafting</workSkill>
      <effectWorking>Smith</effectWorking>
      <soundWorking>Recipe_Machining</soundWorking>
      <recipeUsers>
        <li>TableMachining</li>
      </recipeUsers>
      <workAmount>22000</workAmount>
      <unfinishedThingDef>UnfinishedATV</unfinishedThingDef>
      <skillRequirements>
        <li>
          <skill>Crafting</skill>
          <minLevel>10</minLevel>
        </li>
      </skillRequirements>
    </recipeMaker>
    <colorGenerator Class="ColorGenerator_Options">
      <options>
        <li>
          <weight>10</weight>
          <only>RGBA(0.33,0.33,0.33,1)</only>
        </li>
        <li>
          <weight>10</weight>
          <only>RGBA(0.65,0.65,0.65,1)</only>
        </li>
        <li>
          <weight>30</weight>
          <only>RGBA(0.4,0.3,0.15,1)</only>
        </li>
        <li>
          <weight>6</weight>
          <min>RGBA(0.3,0.3,0.3,1)</min>
          <max>RGBA(0.5,0.5,0.5,1)</max>
        </li>
        <li>
          <weight>2</weight>
          <min>RGBA(0.5,0.5,0.5,1)</min>
          <max>RGBA(1,1,1,1)</max>
        </li>
      </options>
    </colorGenerator>
    <specialDisplayRadius>25.9</specialDisplayRadius>
    <building>
      <turretGunDef>Gun_VehicleTurretImprovised</turretGunDef>
      <turretBurstCooldownTicks>120</turretBurstCooldownTicks>
      <turretTopgraphicPath>Things/Building/Security/TurretImprovised_Top</turretTopgraphicPath>
    </building>
    <researchPrerequisites>
      <li>GunTurrets</li>
    </researchPrerequisites>
  </ThingDef>
<!--
  <ThingDef ParentName="BaseBullet">
    <defName>Bullet_VehicleTurretImprovised</defName>
    <label>improvised vehicle turret bullet</label>
    <graphicData>
      <texPath>Things/Projectile/Bullet_Small</texPath>
      <graphicClass>Graphic_Single</graphicClass>
    </graphicData>
    <projectile>
      <damageDef>Bullet</damageDef>
      <damageAmountBase>5</damageAmountBase>
      <speed>70</speed>
    </projectile>
  </ThingDef>
-->
  <ThingDef ParentName="BaseHumanGun">
    <defName>Gun_VehicleTurretImprovised</defName>
    <label>improvised vehicle turret gun</label>
    <graphicData>
      <texPath>Things/Item/Equipment/WeaponRanged/ChargeRifle</texPath>
      <graphicClass>Graphic_Single</graphicClass>
    </graphicData>
    <menuHidden>true</menuHidden>
    <description>Jury-rigged gun attached to a vehicle turret.</description>
    <soundInteract>InteractRifle</soundInteract>
    <canBeSpawningInventory>false</canBeSpawningInventory>
    <tradeability>Never</tradeability>
    <destroyOnDrop>true</destroyOnDrop>
    <canMakeOnMapGen>false</canMakeOnMapGen>
    <statBases>
      <AimEfficiency>0.35</AimEfficiency>
      <ShotSpread>0.08</ShotSpread>
      <SwayFactor>1.20</SwayFactor>
      <Bulk>7.00</Bulk>
      <Weight>3.00</Weight>
      <RangedWeapon_Cooldown>0.4</RangedWeapon_Cooldown>   <!--
      <AccuracyTouch>0.80</AccuracyTouch>
      <AccuracyShort>0.64</AccuracyShort>
      <AccuracyMedium>0.41</AccuracyMedium>
      <AccuracyLong>0.22</AccuracyLong>
      <RangedWeapon_Cooldown>0.33</RangedWeapon_Cooldown>
    -->
    </statBases>
    <weaponTags>
      <li>TurretGun</li>
    </weaponTags>
    <verbs>
      <li Class="Combat_Realism.VerbPropertiesCR">
        <recoilPattern>Mounted</recoilPattern>
        <recoilAmount>0.72</recoilAmount>
        <verbClass>Combat_Realism.Verb_ShootCR</verbClass>
        <hasStandardCommand>true</hasStandardCommand>
        <projectileDef>Bullet_556x45mmNATO_FMJ</projectileDef>
        <warmupTicks>90</warmupTicks>
        <range>27</range>
        <ticksBetweenBurstShots>5</ticksBetweenBurstShots>
        <burstShotCount>10</burstShotCount>
        <soundCast>GunShotA</soundCast>
        <soundCastTail>GunTail_Light</soundCastTail>
        <muzzleFlashScale>9</muzzleFlashScale>
      </li>
      <!--
      <li>
        <verbClass>Verb_Shoot</verbClass>
        <hasStandardCommand>true</hasStandardCommand>
        <projectileDef>Bullet_VehicleTurretImprovised</projectileDef>
        <warmupTicks>90</warmupTicks>
        <range>25.9</range>
        <ticksBetweenBurstShots>8</ticksBetweenBurstShots>
        <burstShotCount>8</burstShotCount>
        <soundCast>GunShotA</soundCast>
        <soundCastTail>GunTail_Light</soundCastTail>
        <muzzleFlashScale>9</muzzleFlashScale>
      </li>
      -->  
    </verbs>
    <comps>
      <li Class="Combat_Realism.CompProperties_AmmoUser">
        <magazineSize>300</magazineSize>
        <reloadTicks>300</reloadTicks>
        <ammoSet>AmmoSet_556x45mmNATO</ammoSet>
      </li>
      <li Class="Combat_Realism.CompProperties_FireModes">
        <aiUseBurstMode>TRUE</aiUseBurstMode>
        <aiUseAimMode>TRUE</aiUseAimMode>
        <noSnapshot>true</noSnapshot>
        <noSingleShot>true</noSingleShot>
      </li>
    </comps>
  </ThingDef>

</ThingDefs>